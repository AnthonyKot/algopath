{
  "id": "optimization-3",
  "title": "Maximal Rectangle",
  "difficulty": "Hard",
  "leetcode_url": "https://leetcode.com/problems/maximal-rectangle/",
  "related": [
    {
      "id": "optimization-2",
      "title": "Largest Rectangle in Histogram",
      "category": "optimization"
    },
    {
      "id": "dp-5",
      "title": "Maximal Square",
      "category": "dp"
    }
  ],
  "tags": [
    "dp",
    "stack",
    "histogram"
  ],
  "follow_up": {
    "scenario": "The matrix is extremely sparse (99.9% zeros).",
    "trade_off": "The O(N*M) solution processes mainly empty space, wasting cycles.",
    "strategy": "Use Sparse Matrix representation (e.g., List of coordinates for 1s). Iterate only through 1s and look for connected components or use 2D Segment Trees.",
    "answering_guide": "Question the input format. If it's sparse, 'Dense Matrix' algorithms are wrong. pivot to <strong>'Sparse Representation'</strong> (Coordinate List)."
  },
  "content": {
    "problem_statement": "Given a `rows x cols` binary `matrix` filled with `0`'s and `1`'s, find the largest rectangle containing only `1`'s and return *its area*.\n\n**Example 1:**\n```\nInput: matrix = [[\"1\",\"0\",\"1\",\"0\",\"0\"],[\"1\",\"0\",\"1\",\"1\",\"1\"],[\"1\",\"1\",\"1\",\"1\",\"1\"],[\"1\",\"0\",\"0\",\"1\",\"0\"]]\nOutput: 6\nExplanation: The largest rectangle is shown in the bolded 1s.\n```",
    "explanation": {
      "understanding_the_problem": "We need to find the largest all-1s rectangle within a grid.",
      "brute_force": "We could check every possible rectangle. A rectangle is defined by its top-left and bottom-right corners. This would be O(M² * N²) rectangles, and for each, we'd have to check if it's all 1s, leading to a very slow solution.",
      "bottleneck": "Checking every possible rectangle is too slow. We need a more structured approach.",
      "optimized_approach": "This problem can be cleverly reduced to the **'Largest Rectangle in Histogram'** problem.\n\nWe can process the matrix row by row. For each row, we can imagine it as the base of a histogram. The height of each bar at column `j` is the number of consecutive 1s directly above it in that column, including the cell in the current row.\n\nBy doing this, for each row, we generate a new histogram. We can then run the O(N) 'Largest Rectangle in Histogram' algorithm on this generated histogram. The overall maximum area found across all rows will be the answer.",
      "algorithm_steps": "1.  Initialize `maxArea = 0` and a `heights` array of size N (number of columns), filled with zeros.\n2.  Iterate through each `row` of the matrix from top to bottom:\n    a.  Update the `heights` array for the current row: For each column `j`, if `matrix[row][j] == '1'`, increment `heights[j]`. If it's '0', reset `heights[j] = 0`.\n    b.  After updating the `heights` array, it represents a new histogram.\n    c.  Run the 'Largest Rectangle in Histogram' algorithm on this `heights` array.\n    d.  Update `maxArea` with the result.\n3.  Return `maxArea`."
    },
    "quizzes": [
      {
        "question": "What easier problem does this reduce to?",
        "options": [
          "Maximum Subarray Sum",
          "Largest Rectangle in Histogram",
          "Longest Common Subsequence",
          "Knapsack Problem"
        ],
        "correct": 1
      },
      {
        "question": "How do we build the histogram for each row?",
        "options": [
          "Count 1s in row",
          "Accumulate 1s from top (reset on 0)",
          "Count 0s",
          "Randomly"
        ],
        "correct": 1
      },
      {
        "question": "What happens if matrix[i][j] is '0'?",
        "options": [
          "Height becomes 0",
          "Height stays same",
          "Height decreases by 1",
          "Height increases"
        ],
        "correct": 0
      },
      {
        "question": "What is the overall time complexity?",
        "options": [
          "O(M*N)",
          "O(M²*N)",
          "O(M*N²)",
          "O(M+N)"
        ],
        "correct": 0
      },
      {
        "question": "What is the space complexity?",
        "options": [
          "O(1)",
          "O(N) (width of matrix)",
          "O(M*N)",
          "O(M)"
        ],
        "correct": 1
      }
    ]
  },
  "code": {
    "javascript": {
      "solution": "function maximalRectangle(matrix) {\n  if (!matrix.length) return 0;\n  const m = matrix.length, n = matrix[0].length;\n  const heights = new Array(n).fill(0);\n  let maxArea = 0;\n  \n  for (let i = 0; i < m; i++) {\n    for (let j = 0; j < n; j++) {\n      heights[j] = matrix[i][j] === '1' ? heights[j] + 1 : 0;\n    }\n    maxArea = Math.max(maxArea, largestRectangleArea([...heights]));\n  }\n  \n  return maxArea;\n}\n\nfunction largestRectangleArea(heights) {\n  const stack = [];\n  let maxArea = 0;\n  heights.push(0);\n  \n  for (let i = 0; i < heights.length; i++) {\n    while (stack.length && heights[i] < heights[stack[stack.length - 1]]) {\n      const h = heights[stack.pop()];\n      const w = stack.length ? i - stack[stack.length - 1] - 1 : i;\n      maxArea = Math.max(maxArea, h * w);\n    }\n    stack.push(i);\n  }\n  \n  return maxArea;\n}",
      "annotations": [
        {
          "lines": [
            7
          ],
          "text": "Row Scan: Treat each row as the base of a histogram."
        },
        {
          "lines": [
            9
          ],
          "text": "Build Histogram: If '1', add to height. If '0', reset height to 0."
        },
        {
          "lines": [
            11
          ],
          "text": "Solve Subproblem: Run 'Largest Rectangle in Histogram' on current row's heights."
        }
      ]
    }
  },
  "complexity": {
    "time": "O(M * N)",
    "space": "O(N)",
    "explanation_time": "We iterate through M rows, and for each row, we perform an O(N) operation (updating the heights array and running the histogram algorithm). This gives a total time complexity of O(M * N).",
    "explanation_space": "We need O(N) space to store the `heights` array for each row. The stack used in the histogram algorithm also takes O(N) space."
  }
}